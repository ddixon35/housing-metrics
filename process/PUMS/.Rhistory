rcb_raw <- get_psrc_pums(5,2021,"h",c("PRACE","TEN","GRPIP","HINCP"))
rcb <- rcb_raw
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "Else"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
View(inc_rb_rgn)
View(inc_rb_rgn)
library(magrittr)
library(psrccensus)
devtools::install_github("psrc/psrccensus")
library(psrccensus)
devtools::install_github("psrc/psrccensus")
library(magrittr)
library(psrccensus)
library(dplyr)
library(srvyr)
rcb_raw <- get_psrc_pums(5,2021,"h",c("PRACE","TEN","GRPIP","HINCP"))
rcb <- rcb_raw
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "Else"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
library(magrittr)
library(psrccensus)
library(dplyr)
library(srvyr)
rcb_raw <- get_psrc_pums(5,2020,"h",c("PRACE","TEN","GRPIP","HINCP"))
rcb <- rcb_raw
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "Else"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
View(inc_rb_rgn)
rcb_raw <- get_psrc_pums(5,2021,"h",c("PRACE","TEN","GRPIP","HINCP"))
rcb <- rcb_raw
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "Else"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
View(inc_rb_rgn)
inc_rb_rgn[inc_rb_rgn["rent_burden"] == "NA"] <- "No Rent Charged"
inc_rb_rgn$rent_burden %>% replace_na('No Rent Charged')
library(tidyr)
inc_rb_rgn$rent_burden %>% replace_na('No Rent Charged')
rcb <- rcb_raw
# Filter to only renters, create income/rent burden groupings
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "Else"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
# Create output table, sort as needed
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
inc_rb_rgn$rent_burden %>% replace_na('No Rent Charged')
# Filter to only renters, create income/rent burden groupings
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "Else"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
# Create output table, sort as needed
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
View(inc_rb_rgn)
library(tidyr)
install.packages('tidyr')
install.packages("tidyr")
library(tidyr)
inc_rb_rgn$rent_burden %>% replace_na('No Rent Charged')
inc_rb_rgn[inc_rb_rgn$rent_burden == 'NA'] <- 'No Rent Charged'
inc_rb_rgn[inc_rb_rgn$rent_burden == NA] <- 'No Rent Charged'
inc_rb_rgn$rent_burden %>% replace_na("No Rent Charged")
is.na(inc_rb_rgn$rent_burden)
inc_rb_rgn[inc_rb_rgn$rent_burden == 'NA'] <- 'No Rent Charged'
inc_rb_rgn[inc_rb_rgn$rent_burden = NA] <- 'No Rent Charged'
inc_rb_rgn[inc_rb_rgn$rent_burden == NA] <- 'No Rent Charged'
inc_rb_rgn$rent_burden[is.na(inc_rb_rgn$rent_burden)] <- inc_rb_rgn$rent_burden[is.na("No Rent Charged")]
# Filter to only renters, create income/rent burden groupings
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No Rent Charged"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
# Create output table, sort as needed
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
library(magrittr)
library(psrccensus)
library(dplyr)
library(srvyr)
# Filter to only renters, create income/rent burden groupings
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No Rent Charged"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "Else")))
# Create output table, sort as needed
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
# Filter to only renters, create income/rent burden groupings
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No Rent Charged"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "No Rent Charged")))
# Create output table, sort as needed
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
View(inc_rb_rgn)
View(rcb)
View(rcb)
rcb[["variables"]][["rent_burden"]]
View(rcb[["variables"]])
inc_rb_rgn[inc_rb_rgn$rent_burden == 0] <- 'No Rent Charged'
inc_rb_rgn[inc_rb_rgn$rent_burden == ""] <- 'No Rent Charged'
View(inc_rb_rgn)
inc_rb_rgn[inc_rb_rgn$rent_burden == 0] <- "No Rent Charged"
inc_rb_rgn$rent_burden[is.na(inc_rb_rgn$rent_burden)] <- inc_rb_rgn$rent_burden[is.na("No Rent Charged")]
inc_rb_rgn$rent_burden[inc_rb_rgn$rent_burden == ""] <- "No Rent Charged"
inc_rb_rgn$rent_burden[inc_rb_rgn$rent_burden == 0] <- "No Rent Charged"
# Filter to only renters, create income/rent burden groupings
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No Rent Charged"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "No Rent Charged")))
# Create output table, sort as needed
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
inc_rb_rgn <- inc_rb_rgn[(factor(inc_rb_rgn$rent_burden, levels = c("No Rent Charged",
"Greater than 50 Percent",
"Between 30 and 50 Percent",
"Less than 30 Percent",
"Total"))),]
inc_rb_rgn <- inc_rb_rgn[(factor(inc_rb_rgn$rent_burden, levels = c("NA",
"Greater than 50 Percent",
"Between 30 and 50 Percent",
"Less than 30 Percent",
"Total"))),]
inc_rb_rgn <- inc_rb_rgn[(factor(inc_rb_rgn$rent_burden, levels = c(NA,
"Greater than 50 Percent",
"Between 30 and 50 Percent",
"Less than 30 Percent",
"Total"))),]
inc_rb_rgn <- inc_rb_rgn[(factor(inc_rb_rgn$rent_burden, levels = c("Greater than 50 Percent",
"Between 30 and 50 Percent",
"Less than 30 Percent",
"Total"))),]
# Filter to only renters, create income/rent burden groupings
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
income_bin=factor(case_when(HINCP < 25000 ~ "Under $25,000",
HINCP < 35000 ~ "$25,000-$34,999",
HINCP < 50000 ~ "$35,000-$49,999",
HINCP < 75000 ~ "$50,000-$74,999",
HINCP < 100000 ~ "$75,000-$99,999",
HINCP >=100000 ~ "$100,000 or more",
!is.na(HINCP) ~ "Else / Prefer not to answer"),
levels=c("Under $25,000",
"$25,000-$34,999",
"$35,000-$49,999",
"$50,000-$74,999",
"$75,000-$99,999",
"$100,000 or more",
"Else / Prefer not to answer")),
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No Rent Charged"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent", "No Rent Charged")))
# Create output table, sort as needed
inc_rb_rgn <- psrc_pums_count(rcb, group_vars=c("PRACE","income_bin","rent_burden"))
# TITLE: Renter Cost Burden by Race
# GEOGRAPHIES: PSRC Region
# DATA SOURCE: ACS PUMS 5YR
# DATE MODIFIED: 5.22.2023
# AUTHOR: Eric Clute
library(magrittr)
library(psrccensus)
library(dplyr)
library(srvyr)
library(tidyr)
library(purrr)
library(fredr)
years <- c(2010, 2016, 2021)
# ----------------------------- SUMMARIZE BY RACE/ETHNICITY -----------------------------
rcb_re_func <- function(year){
# Pull PUMS data
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb_raw <- get_psrc_pums(5,year,"h",c("PRACE","TEN","GRPIP","HINCP"))
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb_raw <- get_psrc_pums(5,year,"h",c("PRACE","TEN","GRPIP","HINCP"))
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb_raw <- get_psrc_pums(5,2021,"h",c("PRACE","TEN","GRPIP","HINCP"))
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb_raw <- get_psrc_pums(5,2021,"h",c("PRACE","TEN","GRPIP","HINCP"))
years <- c(2010, 2016, 2021)
# ----------------------------- SUMMARIZE BY RACE/ETHNICITY -----------------------------
rcb_re_func <- function(year){
# Pull PUMS data
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb_raw <- get_psrc_pums(5,year,"h",c("PRACE","TEN","GRPIP","HINCP"))
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb <- rcb_raw
# Filter to only renters, create income/rent burden groupings, rename race/ethnicity categories, combine Some other Race & Two or More Races
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No rent paid"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent",
"No rent paid")),
PRACE=factor(case_when(grepl("Other Race|Two or More Races", PRACE) ~"Other or Multiple Races",
grepl("^Black ", PRACE) ~"Black",
grepl("^Hispanic ", PRACE) ~"Hispanic/Latinx",
!is.na(PRACE) ~stringr::str_replace_all(as.character(PRACE), " (and|or) ", "/") %>%
stringr::str_replace(" alone", "") %>%
stringr::str_replace(" Alone", ""))))
# Summarize
rcb_re <- psrc_pums_count(rcb, group_vars = c("PRACE","rent_burden"),rr=TRUE)
rcb_re <- rcb_re %>% pivot_wider(names_from = rent_burden, values_from = c(count, count_moe, share, share_moe, reliability))
# Clean table
rcb_re <- rcb_re[, c(1,3,4,5,6,8,7,9,10,11,13,12,14,15,16,18,17,24,25,26,28,27)]
rcb_re <- rcb_re[rcb_re$PRACE !='Total',]
# Clean variable names
rcb_re <- rcb_re %>% rename_all(~stringr::str_replace_all(.,"count_",""))
rcb_re <- rcb_re %>% rename("No rent paid" = "NA")
rcb_re <- rcb_re %>% rename("moe_No rent paid" = "moe_NA")
rcb_re <- rcb_re %>% rename("Share_No rent paid" = "share_NA")
rcb_re <- rcb_re %>% rename("Reliability_No rent paid" = "reliability_NA")
}
# Run rcb function -----------
rcb_re_all <- map(years, ~rcb_re_func(.x)) %>%
reduce(bind_rows)
library(magrittr)
library(psrccensus)
library(dplyr)
library(srvyr)
library(tidyr)
library(purrr)
library(fredr)
years <- c(2010, 2016, 2021)
# ----------------------------- SUMMARIZE BY RACE/ETHNICITY -----------------------------
rcb_re_func <- function(year){
# Pull PUMS data
setwd("C:/Users/eclute/Downloads")
rcb_raw <- get_psrc_pums(5,year,"h",c("PRACE","TEN","GRPIP","HINCP"))
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb <- rcb_raw
# Filter to only renters, create income/rent burden groupings, rename race/ethnicity categories, combine Some other Race & Two or More Races
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No rent paid"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent",
"No rent paid")),
PRACE=factor(case_when(grepl("Other Race|Two or More Races", PRACE) ~"Other or Multiple Races",
grepl("^Black ", PRACE) ~"Black",
grepl("^Hispanic ", PRACE) ~"Hispanic/Latinx",
!is.na(PRACE) ~stringr::str_replace_all(as.character(PRACE), " (and|or) ", "/") %>%
stringr::str_replace(" alone", "") %>%
stringr::str_replace(" Alone", ""))))
# Summarize
rcb_re <- psrc_pums_count(rcb, group_vars = c("PRACE","rent_burden"),rr=TRUE)
rcb_re <- rcb_re %>% pivot_wider(names_from = rent_burden, values_from = c(count, count_moe, share, share_moe, reliability))
# Clean table
rcb_re <- rcb_re[, c(1,3,4,5,6,8,7,9,10,11,13,12,14,15,16,18,17,24,25,26,28,27)]
rcb_re <- rcb_re[rcb_re$PRACE !='Total',]
# Clean variable names
rcb_re <- rcb_re %>% rename_all(~stringr::str_replace_all(.,"count_",""))
rcb_re <- rcb_re %>% rename("No rent paid" = "NA")
rcb_re <- rcb_re %>% rename("moe_No rent paid" = "moe_NA")
rcb_re <- rcb_re %>% rename("Share_No rent paid" = "share_NA")
rcb_re <- rcb_re %>% rename("Reliability_No rent paid" = "reliability_NA")
}
# Run rcb function -----------
rcb_re_all <- map(years, ~rcb_re_func(.x)) %>%
reduce(bind_rows)
years <- c(2010, 2016, 2021)
# ----------------------------- SUMMARIZE BY RACE/ETHNICITY -----------------------------
rcb_re_func <- function(year){
# Pull PUMS data
setwd("C:/Users/eclute/Downloads")
rcb_raw <- get_psrc_pums(5,year,"h",c("PRACE","TEN","GRPIP","HINCP"))
setwd("J:/Projects/V2050/Housing/Monitoring/2023Update")
rcb <- rcb_raw
# Filter to only renters, create income/rent burden groupings, rename race/ethnicity categories, combine Some other Race & Two or More Races
rcb <- rcb %>% filter(TEN=="Rented") %>%
mutate(
rent_burden=factor(case_when(GRPIP < 30 ~"Less than 30 percent",
between(GRPIP,30,50) ~ "Between 30 and 50 percent",
GRPIP > 50 ~ "Greater than 50 percent",
!is.na(GRPIP) ~ "No rent paid"),
levels=c("Greater than 50 percent",
"Between 30 and 50 percent",
"Less than 30 percent",
"No rent paid")),
PRACE=factor(case_when(grepl("Other Race|Two or More Races", PRACE) ~"Other or Multiple Races",
grepl("^Black ", PRACE) ~"Black",
grepl("^Hispanic ", PRACE) ~"Hispanic/Latinx",
!is.na(PRACE) ~stringr::str_replace_all(as.character(PRACE), " (and|or) ", "/") %>%
stringr::str_replace(" alone", "") %>%
stringr::str_replace(" Alone", ""))))
# Summarize
rcb_re <- psrc_pums_count(rcb, group_vars = c("PRACE","rent_burden"),rr=TRUE)
rcb_re <- rcb_re %>% pivot_wider(names_from = rent_burden, values_from = c(count, count_moe, share, share_moe, reliability))
# Clean table
rcb_re <- rcb_re[, c(1,3,4,5,6,8,7,9,10,11,13,12,14,15,16,18,17,24,25,26,28,27)]
rcb_re <- rcb_re[rcb_re$PRACE !='Total',]
# Clean variable names
rcb_re <- rcb_re %>% rename_all(~stringr::str_replace_all(.,"count_",""))
rcb_re <- rcb_re %>% rename("No rent paid" = "NA")
rcb_re <- rcb_re %>% rename("moe_No rent paid" = "moe_NA")
rcb_re <- rcb_re %>% rename("Share_No rent paid" = "share_NA")
rcb_re <- rcb_re %>% rename("Reliability_No rent paid" = "reliability_NA")
}
# Run rcb function -----------
rcb_re_all <- map(years, ~rcb_re_func(.x)) %>%
reduce(bind_rows)
